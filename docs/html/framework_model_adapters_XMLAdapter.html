<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>XMLAdapter</title><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link rel="stylesheet" type="text/css" href="../css/VisDoc.css" /><script src="../js/jquery.js" type="text/javascript">//</script><script src="../js/common.js" type="text/javascript">//</script><script src="../js/doc.js" type="text/javascript">//</script></head><body id="page_framework_model_adapters_XMLAdapter"><script type="text/javascript">VisDoc.initBody();</script><div id="PageTop"><!----></div><div class="VisDoc"><div class="content"><div class="docNav"><ul><li><div id="twistyTOC_show" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited activeWhenNotFramed"><a href="#"><span class="icon">+</span>Show TOC</a></div><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("twistyTOC_show");</script><div id="twistyTOC_hide" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited activeWhenFramed"><a href="#"><span class="icon">&times;</span>Hide TOC</a></div><span id="twistyTOC_toggle" class="twistyContent"><!----></span><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("twistyTOC_hide");</script></li></ul><ul class="accessKeyLinks"><li><a href="#PageTop" accesskey="t"><span class="accessKey">T</span>op</a></li><li><a href="#Summary" accesskey="s"><span class="accessKey">S</span>ummary</a></li><li><a href="#Constructor" accesskey="c"><span class="accessKey">C</span>onstructors</a></li><li><a href="#Instanceproperties" accesskey="l">Instance <span class="accessKey">p</span>roperties</a></li><li><a href="#Instancemethods" accesskey="m">Instance <span class="accessKey">m</span>ethods</a></li><li><a href="#Eventhandlers" accesskey="e"><span class="accessKey">E</span>vent handlers</a></li></ul><br class="clear" /></div><h1>XMLAdapter</h1><div class="classProperties"><table cellspacing="0"><tr><th align="left">Kind of class:</th><td>public class</td></tr><tr><th align="left">Package:</th><td><a class="className" href="package-framework_model_adapters.html">framework.model.adapters</a></td></tr><tr><th align="left">Inherits from:</th><td><a class="className" href="framework_model_adapters_AdapterBase.html">AdapterBase</a> &lt; EventDispatcher</td></tr><tr><th class="classDetails" align="left">Classpath:</th><td class="classDetails">framework.model.adapters.XMLAdapter</td></tr><tr><th class="classDetails" align="left">File last modified:</th><td class="classDetails">Friday, 04 December 2009, 08:24:13</td></tr></table></div><div id="sourceCodeTop" class="sourceCodeView"><div id="twistyViewSourceshow" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting twistyAnimate"><a href="#"><span class="icon">►&nbsp;</span><span class="linkLabel">View source</span></a></div><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("twistyViewSourceshow");</script><div id="twistyViewSourcehide" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting twistyAnimate"><a href="#"><span class="icon">▼&nbsp;</span><span class="linkLabel">Hide source</span></a></div><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("twistyViewSourcehide");</script><div id="twistyViewSourcetoggle" class="twistyContent twistyMakeHidden twistyRememberSetting"><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("twistyViewSourcetoggle");</script><div class="sourceCode"><textarea rows="10" cols="10" id="source" readonly="readonly">package framework.model.adapters 
{
    import flash.events.*;
    import flash.net.*;
    import framework.cache.*;
    import framework.model.*;
    import framework.net.*;
    import framework.utils.*;
    
    public class XMLAdapter extends AdapterBase
    {
        // This class was created to read and write XML files generated by Excel
        // Feel free to create your own adapter based on a different schema
        
        private var excelBaseXML:String = '&lt;?xml version="1.0"?>\n&lt;Workbook xmlns="urn:schemas-microsoft-com:office:spreadsheet"\n xmlns:o="urn:schemas-microsoft-com:office:office"\n xmlns:x="urn:schemas-microsoft-com:office:excel"\n xmlns:ss="urn:schemas-microsoft-com:office:spreadsheet"\n xmlns:html="http://www.w3.org/TR/REC-html40">\n &lt;DocumentProperties xmlns="urn:schemas-microsoft-com:office:office">\n  &lt;Author>Wrapper ActionScript Framework&lt;/Author>\n  &lt;LastAuthor>Wrapper ActionScript Framework&lt;/LastAuthor>\n  &lt;Created>2009-12-02T16:14:27Z&lt;/Created>\n  &lt;Company>Motion &amp;amp; Color&lt;/Company>\n  &lt;Version>12.256&lt;/Version>\n &lt;/DocumentProperties>\n &lt;OfficeDocumentSettings xmlns="urn:schemas-microsoft-com:office:office">\n  &lt;AllowPNG/>\n &lt;/OfficeDocumentSettings>\n &lt;ExcelWorkbook xmlns="urn:schemas-microsoft-com:office:excel">\n  &lt;WindowHeight>17260&lt;/WindowHeight>\n  &lt;WindowWidth>24800&lt;/WindowWidth>\n  &lt;WindowTopX>-20&lt;/WindowTopX>\n  &lt;WindowTopY>-20&lt;/WindowTopY>\n  &lt;Date1904/>\n  &lt;ProtectStructure>False&lt;/ProtectStructure>\n  &lt;ProtectWindows>False&lt;/ProtectWindows>\n &lt;/ExcelWorkbook>\n &lt;Styles>\n  &lt;Style ss:ID="Default" ss:Name="Normal">\n   &lt;Alignment ss:Vertical="Bottom"/>\n   &lt;Borders/>\n   &lt;Font ss:FontName="Verdana"/>\n   &lt;Interior/>\n   &lt;NumberFormat/>\n   &lt;Protection/>\n  &lt;/Style>\n &lt;/Styles>\n &lt;Worksheet ss:Name="{name}">\n  &lt;Table ss:ExpandedColumnCount="3" ss:ExpandedRowCount="6" x:FullColumns="1"\n   x:FullRows="1">\n{data}\n  &lt;/Table>\n  &lt;WorksheetOptions xmlns="urn:schemas-microsoft-com:office:excel">\n   &lt;PageLayoutZoom>0&lt;/PageLayoutZoom>\n   &lt;Selected/>\n   &lt;ProtectObjects>False&lt;/ProtectObjects>\n   &lt;ProtectScenarios>False&lt;/ProtectScenarios>\n  &lt;/WorksheetOptions>\n &lt;/Worksheet>\n&lt;/Workbook>'
        private var excelBaseRow:String = '&lt;Row>\n{data}&lt;/Row>\n'
        private var excelBaseCell:String = '&lt;Cell>&lt;Data ss:Type="String">{data}&lt;/Data>&lt;/Cell>\n'
        
        public function XMLAdapter( model:ModelBase, cache:Cache, models:Models )
        {
            super( model, cache, models );
        }
        
        override public function export( id:int=-1 ) : String
        {
            var result:String = "";
            var data:String = ""
            var row:String = "";
            var column:String;
            var clazz:* = models.getModel( model.className );
            var columns:Array = models.columns( model.className );
            var cells:String = ""
            for each( column in columns ) {
                cells += excelBaseCell.split("{data}").join( column );
            }
            data += excelBaseRow.split("{data}").join(cells);
            
            if( id == -1 ) {
                for each( var item:* in clazz["all"]() ){
                    cells = ""
                    for each( column in columns ){
                        cells += excelBaseCell.split("{data}").join( item[column] );
                    }
                    data += excelBaseRow.split("{data}").join(cells);
                }
            }else{
                cells = ""
                for each( column in columns ){
                    cells += excelBaseCell.split("{data}").join( clazz["findById"]( id )[ column ] );
                }
                data += excelBaseRow.split("{data}").join(cells);
            }
            result = excelBaseXML.split("{data}").join(data).split("{name}").join(model.className);
            return result;
        }
        
        public function load( path:String ):void
        {
            assets.add( path ).addEventListener( Event.COMPLETE, onLoad );
            assets.load();
        }
        
        private function onLoad( event:Event ):void
        {    
            var xml:XML = new XML( event.target.data );
            var className:String = StringUtils.className( model );
            var clazz:Class = models.getModel( className );
            var headerSet:Boolean = false;
            var ns:Namespace = xml.namespace();
            var columns:Array = [];
            for each( var r:XML in xml..ns::Row ) {
                var cell:XML;
                if( !headerSet ){
                    for each( cell in r.ns::Cell.ns::Data ) {
                        var value:String = cell.text().toString();
                        models.columns( className ).push( value );
                        columns.push( value );
                    }
                    headerSet = true;
                }else{
                    var instance:* = new clazz();
                    var index:int = models.push( className, instance );
                    var count:int = 0;
                    for each( cell in r.ns::Cell.ns::Data ) {
                        var column:String = columns[count];
                        for each( var at:XML in cell.@*){
                            if(at.toString() == "String"){
                                instance[column] = cell.text().toString();
                            }else if(at.toString() == "Number"){
                                instance[column] = parseFloat(cell.text().toString());
                            }
                        }
                        if( models.isAssociatedProperty( className, column ) ){
                            var associatedObject:* = models.getAssociationForProperty(className, column)["class"].findById( cell );
                            if( associatedObject != null ){
                                var name:String = StringUtils.pluralize( className ).toLowerCase();
                                if( !associatedObject.hasOwnProperty( name ) ) {
                                    associatedObject[ name ] = [];
                                }
                                associatedObject[ name ].push( instance );
                            }
                        }
                        count++
                    }
                    instance.id = index;
                }
            }
            models.dispatchEvent(new Event( "modelLoaded" ) );
        }
    }
}
</textarea></div></div></div><div class="classDescription"></div><div class="summary"><h2 id="Summary">Summary</h2><div class="docNav"><ul><li><div id="twistyTypeInfo_show" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting"><a href="#"><span class="icon">&times;</span>Hide type info</a></div><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("toggleTypeInfo_on");</script><div id="twistyTypeInfo_hide" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting"><a href="#"><span class="icon">+</span>Show type info</a></div><span id="twistyTypeInfo_toggle" class="twistyContent"><!----></span><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("toggleTypeInfo_off");</script></li><li><div id="twistySort_show" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting"><a href="#"><span class="icon">&times;</span>Sort by source order</a></div><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("toggleSort_on");</script><div id="twistySort_hide" class="twistyTrigger twikiUnvisited twikiMakeVisible twistyInited twistyRememberSetting"><a href="#"><span class="icon">+</span>Sort alphabetically</a></div><span id="twistySort_toggle" class="twistyContent"><!----></span><script type="text/javascript">twiki.JQueryTwistyPlugin.initId("toggleSort_off");</script></li></ul><br class="clear" /></div><div class="memberList"><div class="memberSummaryPart"><span class="title">Constructor</span><ul class="sortable" id="sortul1"><li class="sortli listnum1"><a href="#XMLAdapter">XMLAdapter</a><span class="typeInfo"> (model:<a class="className" href="framework_model_ModelBase.html">ModelBase</a>)</span></li></ul></div><div class="memberSummaryPart"><span class="title">Instance methods</span><ul class="sortable" id="sortul2"><li class="sortli listnum1"><a href="#export">export</a><span class="typeInfo"> (id:int = -1) : String</span></li><li class="sortli listnum2"><a href="#load">load</a><span class="typeInfo"> (path:String) : void</span></li></ul><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Instance methods inherited from <span class="superclass"><a class="className" href="framework_model_adapters_AdapterBase.html">AdapterBase</a></span></span><div class="item inheritedList"><a href="framework_model_adapters_AdapterBase.html#export">export</a></div></div></div></div></div></div></div><div class="memberSection"><h2 id="Constructor">Constructor</h2><div class="member" id="XMLAdapter"><h3>XMLAdapter</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code"><span class="memberAccess">public</span> function <b>XMLAdapter</b> (


</div><div class="code">model:<a class="className" href="framework_model_ModelBase.html">ModelBase</a>,
cache:<a class="className" href="framework_cache_Cache.html">Cache</a>,
models:<a class="className" href="framework_model_Models.html">Models</a>)</div><br class="clear" /></div></div></div></div><div class="memberSection"><h2 id="Instancemethods">Instance methods</h2><div class="member" id="export"><h3>export</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code"><span class="memberAccess">override public</span> function <b>export</b> (
</div><div class="code">id:int = -1) : String</div><br class="clear" /></div></div><div class="boxWithBorder"><div class="boxedElem"><div class="contentHolder"><span class="title">Overrides:</span><div class="item"><ul><li> <a href="framework_model_adapters_AdapterBase.html#export">AdapterBase.export</a> </li></ul></div></div></div></div></div><div class="member" id="load"><h3>load</h3><div class="fullMemberString"><div class="floatholder"><div class="floatbox code"><span class="memberAccess">public</span> function <b>load</b> (
</div><div class="code">path:String) : void</div><br class="clear" /></div></div></div></div><div class="footer"><ul class="docFooter"></ul></div></div></div></body></html>